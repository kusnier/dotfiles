#!/usr/bin/env coffee

port      = 51235
localroot = '/Users/kuse/devel/'
http      = require 'http'
url       = require 'url'
exec      = require('child_process').exec

server = http.createServer (request, response) ->
  response.writeHead 200, {"Content-Type": "text/plain"}
  query = url.parse(request.url, true).query
  if request.url = '/icon'
    # ignore this request, IDE Connectors (Atlassian)
  else if query.file
    console.log "Open file: " + query.file
    exec('mvim ' + localroot + query.file)
  else
    console.log "Unsupported command."
  response.end "All done.\n"

server.listen 51235

console.log("Editsucker-Server running at port " + port)
